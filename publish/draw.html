<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional"><html><head><meta http-equiv="content-type" content="text/html;charset=iso-8859-1"><title>Red by Example</title><style type="text/css">html, body, p, td, li {font-family: arial, sans-serif, helvetica; font-size: 10pt;}h1 {font-size: 16pt; Font-Weight: bold;}h2 {font-size: 14pt; color: #2030a0; Font-Weight: bold; width: 100%;    border-bottom: 1px solid #c09060;}h3 {font-size: 12pt; color: #2030a0; Font-Weight: bold;}h4 {font-size: 10pt; color: #2030a0; Font-Weight: bold;}h5 {font-size: 10pt; Font-Weight: bold;}tt {font-family: "courier new", monospace, courier; color: darkgreen;}pre {font: bold 10pt "courier new", monospace, console;    background-color: #f4f6f6; padding: 16px; border: solid #a0a0a0 1px;}.toc1 {margin-left: 1cm; font-size: 12pt; font-weight: bold;}.toc2 {margin-left: 2cm; font-size: 10pt; font-weight: bold; text-decoration: none;}.toc3 {margin-left: 3cm; font-size: 10pt; text-decoration: none;}.toc4 {margin-left: 4cm; font-size: 10pt; color: grey; text-decoration: none;}.output {color: #000080; font-weight: normal;}.note {background-color: #f0e090; width: 100%; padding: 16px; border: solid #a0a0a0 1px;}.tail {color: gray; font-size: 8pt;}.mike-large{color:blue; font-size: 13pt; font-weight:bold; }  .mike-small{ font-size: 10pt; }</style></head><body bgcolor="white"><center><table width="660" cellpadding="4" cellspacing="0" border="0"><tr><td><!----------------------------------------------------------------------------><h1 style="color:red; id=top">Red by Example - an accessible reference by example</h1>Last update on 20-Dec-2019<h2>draw</h2><pre><a href="index.html">index</a>     <a href="parse.html">parse</a>     <a href="vid.html">vid</a>     <a href="series.html">series</a>     <a href="draw.html">draw</a>     <a href="help.html">help</a>     <a href="about.html">about</a>     <a href="links.html">links</a>     <a href="contact.html">contact</a>     </pre><pre><a href="#1">1. DRAWING WITH RED</a><br><a href="#2">1.1. Introduction         </a><br><a href="#3">2.1. Drawing A Line and Box On A Canvas</a><br><a href="#4">2.2. Pens, Fill-pens, color</a><br><a href="#5">2.3. Drawing Text</a><br><a href="#6">3.1. The Draw Block - Introduction</a><br><a href="#7">3.2. The Draw Block - Variables, Compose, Reduce</a><br><a href="#8">3.3. A 'do' Block For Initialisation</a><br><a href="#9">4.1. Animation: Rate, On-time</a><br><a href="#10">4.2. The Bouncing Ball Program</a><br><a href="#11">5.1. Mouse Coordinates, Events, All-over</a><br><a href="#12">5.2. Shape Sub-dialect</a><br><a href="#13">6.1 Transformations On Drawings</a><br></pre><br><h2 id="1">1. DRAWING WITH RED</h2></pre><h2 id="2">1.1. Introduction         </h2><pre><br>The Draw dialect is a domain-specific language intended to simplify <br>drawing.  The language was created in Red itself.  However, when you draw <br>lines, shapes,  animations, you will also make use of Red, and of VID (to <br>place and set up GUI widgets - 'faces').  Here, we will work through some <br>typical graphics tasks, and introduce - or remind you - about relevant Red <br>and VID facilities.<br><br>This page is only a sampling of Draw.  It does not cover ways of speeding-up <br>animations, or the full range of facilities.  Draw has many commands, and <br>some of these have many options - so you will need to explore its official <br>documentation:<br><br>Draw: <a href="https://doc.red-lang.org/en/draw.html"><br>https://doc.red-lang.org/en/draw.html<br></a><br><br>There are some impressive demos on:<br><a href="http://www.red-lang.org/2016/03/060-red-gui-system.html"><br>http://www.red-lang.org/2016/03/060-red-gui-system.html<br></a><br><br>You might also need VID:<br><br>Official: <a href="https://doc.red-lang.org/en/vid.html"><br>https://doc.red-lang.org/en/vid.html<br></a><br><br>Red-by-example: <a href="http://www.red-by-example.org/vid.html"><br>http://www.red-by-example.org/vid.html<br></a><br><br>When building a GUI with tightly-linked widgets, it can be very useful to <br>use Red's reactive programming facilities, as shown here:<br><br><a href="http://www.red-lang.org/2016/06/061-reactive-programming.html"><br>http://www.red-lang.org/2016/06/061-reactive-programming.html<br></a><br><br>Thanks to Gregg Irwin for suggestions:<br><a href="https://gist.github.com/greggirwin"><br>https://gist.github.com/greggirwin<br></a><br><br><a href="#top">top</a></pre><h2 id="3">2.1. Drawing A Line and Box On A Canvas</h2><pre><br>Here is the code for our first program:<br><br>Red [ needs 'view ]<br><br>view [   <br>   canvas: base 150x150 draw [line 10x0 160x50]<br>] <br> <br>Screenshot:<br><img src="draw-line1.png" alt="draw-line1.png"><br><br>The program needs to incorporate  View facilities, at the top.<br><br>We use a VID view  to set up and place faces (GUI widgets, controls)  on the <br>window.  Here, we only use a <a href="index.html#0base">base</a> (though we could also draw on an <br><a href="index.html#0image">image</a>).  We chose to name it 'canvas'.<br><br>Following the draw, we have a block of drawing commands, with values if <br>necessary.  Here we draw a <a href="index.html#2line">line</a> from 10x0 to 160x50.  Note that the <br>line is too long, and the extra part is clipped.<br><br>The top left of the base is (0, 0), and in Red we use <a href="index.html#pairxex">pair!</a> notation - <br>such as 0x0.<br><br>Next we extend the program to draw a <a href="index.html#2box">box</a>, providing its top-left and <br>bottom-right coordinates.  We have also used a VID option to make the <br>canvas white.<br><br>Red [ needs 'view ]<br><br>view [ <br>    canvas: base 150x150 white   draw [<br>        line 10x0 160x50<br>        box 10x10 100x80<br>    ]  <br>] <br><br>Screenshot:<br><img src="draw-line-and-box.png" alt="draw-line-and-box.png"><br><br>In fact, a box can be created by specifying any 2 opposite corners (such as <br>bottom-left and top-right).<br><br>There are lots of shapes, such as circle, ellipse, polygon, etc.  Details <br>are in the Draw official documentation.<br><br>Note that we provide values - not variables, expressions - for the shape <br>coordinates.  We cannot put, for example:<br><br>    xy-coords: 22x33<br><br>    draw [line xy-coords 100x100]      ;-- no!<br><br>Later, we will see how to work with this.<br><br>Drawing commands can be placed in nested blocks, as in:<br><br>      [[line 10x0 160x50] [box 10x10 100x80]]<br><br>The end result is the same, but the structure can be useful if we need to <br>process shapes (e.g. deleting a particular shape).<br><br><a href="#top">top</a></pre><h2 id="4">2.2. Pens, Fill-pens, color</h2><pre><br>Drawing lines and unfilled shapes is done with a <a href="index.html#2pen">pen</a>, whereas filled <br>shapes are drawn with a <a href="index.html#2fill-pen">fill-pen</a>.  <br><br>They have default settings (a 1-pixel black line etc.) but we can provide <br>new settings, such as colour, width, and thickness.<br><br>Here is an example:<br><br>Red [ needs 'view ]<br>view [ <br>    canvas: base 200x200 white  draw [<br>        pen blue line-width 8 line 10x0 160x50<br>        pen red box 10x10 100x60<br>        fill-pen pink box 10x80 120x140<br>        pen off  box 10x150 120x190<br>    ]  <br>]<br><br>Screenshot:<br><img src="draw-pens.png" alt="draw-pens.png"><br><br>We created a blue pen with an 8-pixel width, and drew a line.  The pen <br>command must be followed immediately by a colour.<br><br>We altered the pen to red, and drew a box, unfilled.<br><br>We set the fill-pen to pink, then drew a box - note the red edges.<br><br>We turned the pen off, then drew a pink box.  There are no edges on the box.<br><br>There are more pen options, such as specifying the shape of the line-end, <br>and how joins appear.  <br><br>Note also that we can draw on an <a href="index.html#0image">image</a> widget, as in :<br><br>Red [needs 'View]<br><br>view [<br>    photo: image 250x250 %country.png  <br>        draw [fill-pen gold pen off circle 100x50 25]  ;-- add sun<br>]<br><br>Screenshot, showing the added 'sun':<br><img src="draw-sun.png" alt="draw-sun.png"><br><br><a href="#top">top</a></pre><h2 id="5">2.3. Drawing Text</h2><pre><br>We can incorporate text in a drawing, as follows:<br><br>Red [needs 'View ]<br>view [<br>    canvas: base 150x150 white  <br>        draw [text 50x50 "Hello!!!!" circle 70x60 40]<br>]<br>    <br>Screenshot:<br><img src="draw-text.png" alt="draw-text.png"><br><br>If your text in not part of  the drawing (such as instructions, captions on <br>faces - widgets) - you can use the VID <a href="index.html#0text">text</a> face.<br><br>It is also possible to specify fonts and sizes.<br><br><a href="#top">top</a></pre><h2 id="6">3.1. The Draw Block - Introduction</h2><pre><br>In the earlier examples, we followed 'draw' with a block of commands.  This <br>is the 'draw-block'.  We can add or remove items to it, as required.<br><br>Here, we introduce a button, and show how to use a draw-block.   We have the <br>code:<br><br>Red [needs 'view]<br><br>do-but1: function [] [<br>    print ["canvas/draw-before:  " canvas/draw]<br>    print ["size ..  " canvas/size]<br>    canvas/size: 160x200<br>    canvas/draw: [fill-pen blue box 10x10 60x60]<br>    print ["canvas/draw-after: " canvas/draw]<br>]<br><br>view [<br>   b1: button "draw" [ do-but1]<br>   return   <br>   canvas: base 200x200  white draw [ box 44x44 88x88]<br>]<br><br>Running it shows:<br><img src="draw-block1.png" alt="draw-block1.png"><br><br>When we click the button, the canvas goes smaller, and we see a blue box:<br><img src="draw-block2.png" alt="draw-block2.png"><br><br>We also see this printed on the console:<br><br>    canvas/draw-before:   box 44x44 88x88<br>    size ..   200x200<br>    canvas/draw-after:  fill-pen blue box 10x10 60x60<br><br>Note the printing: we can access options using the /refinement notation, as <br>in canvas/size.  The /draw contains a block of drawing instructions.   It <br>only holds one block, so when we assign the instructions to draw a blue box, <br>the previous state is erased.  However it is easy to add drawing <br>instructions to the block, like this:<br><br>    canvas/draw: [fill-pen blue box 10x10 60x60]<br>    append canvas/draw [box 33x33 170x55]      ;-- added this - another blue <br>box <br>    print ["canvas/draw-after: " canvas/draw].<br><br>It draws 2 blue boxes, and prints:<br><br>    canvas/draw-before:   box 44x44 88x88<br>    size ..   200x200<br>    canvas/draw-after:  fill-pen blue box 10x10 60x60 box 33x33 170x55<br> <br>We could use append/only if we wanted to keep each shape in its own block, <br>to allow access to individual shapes.<br><br>Here is another example, which initially draws an unfilled box.  It detects <br>the <a href="index.html#0on-down">on-down</a> (mouse-click) event  of the base, then draws a red filled <br>box.  The initial box vanishes of course, because the draw block is <br>completely replaced by a new one.<br><br>Red [ needs 'view ]<br>  <br>in-canvas: function [] [<br>    canvas/draw: [ fill-pen red box 2x2 30x30] <br>]<br><br>view [<br>    canvas: base 200x200   white draw [ box 44x44 88x88]<br>        on-down[in-canvas]<br>]<br><br>In summary, when the draw-block is drawn, the previous drawing is erased, <br>and the new drawing is created.  If you want something drawn, put it in the <br>block.<br><br>The draw-block thus contains the whole drawing, as text.  You can manipulate <br>it, for example to add an 'undo' facility, or to select part of the drawing.<br> <br><a href="#top">top</a></pre><h2 id="7">3.2. The Draw Block - Variables, Compose, Reduce</h2><pre><br>What if we want to use a variable, as in:<br><br>    top-left: 22x33<br>    draw [ line top-left 100x100]<br><br>We can't do this - the draw block must use values.  We need to do some kind <br>of evaluation first, and in Red, we can use <a href="index.html#compose">compose</a> and <a href="index.html#reduce">reduce</a>. They <br>are similar, and here is a summary:<br><br>The word <a href="index.html#reduce">reduce</a> returns a copy of a block, evaluating all expressions<br>in the block.<br><br>The word <a href="index.html#compose">compose</a> returns a copy of a block, evaluating only <a href="index.html#parenxex">paren!</a> <br>items. A paren! type is surrounded in (parentheses).<br><br>We can also use Red symbols.  For example the symbol:<br><br>    'elephant<br><br>evaluates to:<br><br>    elephant<br><br>Here are some examples:<br><br>>> a: 11   b: 22    ;-- create some variables and a block<br>>> blk: [line (a + b) a + b "message" 123]<br>>> compose blk<br>== [line 33 a + b "message" 123]   ;-- note   (...)  effect<br>>> <br>>> ;-- now try reduce, on same block<br>== [line (a + b) a + b "message" 123]<br>>> reduce blk<br>*** Script Error: line has no value<br><br>>> ;-- try another block, with a 'symbol<br>>> blk: ['line a b]<br>>> reduce blk<br>== [line 11 22]   ;-- what we want<br><br>Here is a practical example - we want to use a variable for the start of a <br>line.  We can use compose or reduce:<br><br>    top-left: 4x0<br><br>    compose [pen red line (top-left) 3x66]     ;compose only ( )<br>    reduce  ['pen red 'line top-left 3x66]<br><br> Either of these results in:<br>    <br>    pen 255.0.0 line 4x0 3x66<br><br>Here is a program which draws a line at a different place, with every <br>button-click.  Note that we cannot append to an uninitialised block, so we <br>have used the VID 'do' feature for some once-only initialisation.<br>  <br>Red [needs 'view]<br>line-end: 100x100<br><br>do-but1: func [] [     ;--func allows easier global use<br>    append canvas/draw compose [line 0x100 (line-end)]<br>    line-end: line-end + 0x10<br>]<br><br>view [<br>    b1: button "draw" [do-but1]<br>    return<br>    canvas: base 200x200 white<br>    <br>    do [                    ;-- initialisation<br>        canvas/draw: copy []<br>    ]<br>]<br><br>Screenshot:<br><img src="draw-block-fan.png" alt="draw-block-fan.png"><br><br>Here is the same basic program, but one click causes 10 lines to be drawn <br>rapidly, without any user-interaction.  The button-click code is:<br><br><br>do-but1: func [] [<br>    line-end: 100x100<br>    loop 10 [<br>        append canvas/draw compose [line 0x100 (line-end)]<br>        line-end: line-end + 0x10<br>    ]   <br>]<br><br><a href="#top">top</a></pre><h2 id="8">3.3. A 'do' Block For Initialisation</h2><pre><br>Sometimes it is useful to initialise variables and faces.  We can add<br>a 'do' block at the bottom of view.  It contains Red code, as in:<br><br>Red [needs 'View]<br>b: false<br>... etc<br><br>view [<br> 	canvas: base white 350x350 <br>        ; ...etc<br>        <br>	do [<br>		canvas/draw: [box 10x10 30x30]  ;-- initial shape<br>        b: true<br>	]<br>]<br><br><br><a href="#top">top</a></pre><h2 id="9">4.1. Animation: Rate, On-time</h2><pre><br>Each face can have a <a href="index.html#0rate">rate</a> timer, which can be made to tick regularly, <br>or wait for a duration.<br><br>An integer value (above 0)  sets a frequency (per second), a <a href="index.html#timexex">time!</a> type  <br>sets a duration, and <a href="index.html#none">none</a> stops it.  Here, we set the canvas rate to 1 <br>(per second), and detect the tick via the <a href="index.html#on-time">on-time</a> event. The blue square <br>moves diagonally across the screen, to the bottom-right.<br><br>Red [ needs 'view ]<br><br>top-left: 10x10<br><br>canvas-tick: func [] [<br>    top-left: top-left + 8x8   <br>    canvas/draw: reduce ['fill-pen blue 'box top-left  top-left + 55x55]     <br>]<br><br>view [<br>    canvas: base 200x200   white rate 1 <br>        on-time [canvas-tick]<br>]<br><br>The animation is jerky, but try changing the increment to e.g. 1x1, and the <br>rate to 20, for a gliding blue box.<br><br><a href="#top">top</a></pre><h2 id="10">4.2. The Bouncing Ball Program</h2><pre><br>This is a standard animation example.  A blue ball bounces around the <br>screen.  You can stop and start it with buttons -  it manipulates the rate <br>to do this. The items you might wish to play around with have been <br>initialised at the top of the code. <br><br>It could be improved - the testing for wall contact involves the centre of <br>the ball, whereas it should be the edge.  Some work for you to do!<br><br>Red [needs 'view]<br><br>draw-freq: 25   ;-- init<br>centre: 10x10<br>x-step: 1<br>y-step: 3<br><br>in-canvas: func [] [       ;-- for every tick<br>    canvas/rate: draw-freq   <br>    ;-- hit an edge?  And add a bit of randomness, for fun.<br>    if centre/x &gt; 300 [x-step: -1 * x-step - random 0.2] <br>    if centre/y &gt; 300 [y-step: -1 * y-step - random 0.2]<br>    if centre/x &lt; 0 [x-step: -1 * x-step]<br>    if centre/y &lt; 0 [y-step: -1 * y-step]   <br>    incr: to-pair reduce [(3 * x-step) (3 * y-step)]  <br>    centre: centre + incr<br>    canvas/draw: reduce ['fill-pen blue 'circle centre 8]    <br>    ;-- use append in above line, if you want a ball trail<br>]<br><br>do-stop: func [] [ <br>    canvas/rate: none     ;-- stop timer<br>]<br><br>do-start: func [] [<br>    canvas/rate: draw-freq   ;starts<br>]<br><br>view [<br>    stop-btn: button "stop" [do-stop]<br>    start-btn: button "start" [do-start]<br>    return<br><br>    ;-- rate set in do-block, below<br>    canvas: base 300x300 white <br>    on-time [in-canvas]<br>    <br>    do [                         ;-- init <br>        canvas/rate: draw-freq<br>        canvas/draw: copy []     ;-- for the first append<br>    ]    <br>]<br><br><a href="#top">top</a></pre><h2 id="11">5.1. Mouse Coordinates, Events, All-over</h2><pre><br>When drawing with user-interaction, we can use buttons, etc, and it can also <br>be useful to use the mouse position.   Here is a fragment of code.  When we <br>click on the base, 'do-down' is called, passing the event object into 'ev'.  <br>The /offset refinement provides the position where the left mouse button was <br>depressed.<br><br>do-down: func [ev] [<br>    xy-pos: ev/offset       ;-- mouse position -  a pair<br>    ;--   etc...<br>]<br><br>view [<br>    canvas: base 300x300 white on-down [do-down event]<br>]<br><br>Here is a program which draws straight lines between successive mouse-clicks:<br><br>Red [needs 'View<br>     title: "Sketch with mouse"<br>]<br><br>sketching: false<br><br>do-down: func [ev] [<br>    xy-New: ev/offset         ;-- mouse position - pair<br>    either not sketching [    ;-- first time?<br>        sketching: true<br>        xy-Start: xy-New      ;-- no visible line<br>    ] [<br>        append canvas/draw compose [line (xy-Start) (xy-New)]<br>        xy-Start: xy-New      ;-- remember where we were<br>    ]<br>]<br><br>clear-canvas: func [ev] [<br>    sketching: false<br>    xy-Start: ev/offset<br>    canvas/draw: copy [pen red line-width 7] <br>]<br><br>view [<br>    break-btn: button "Break line" [sketching: false]<br>    clear-btn: button "Clear" [clear-canvas event]<br>    return<br>    canvas: base 300x200 white draw [pen red line-width 7]<br>        on-down [do-down event]           ;-- click in canvas?<br>]<br><br>And a screenshot:  <br><img src="draw-red-mouse.png" alt="draw-red-mouse.png"> <br><br>Here is another example which uses the VID <a href="index.html#0all-over">all-over</a> command.  This <br>allows us to pick up mouse-move events.<br><br>This program lets you click anywhere on the canvas, and drag open a box to <br>the required size.<br><br>Red [needs 'View]<br><br>mouse-state: 'up<br>draw-block: copy []<br>coord1: 0x0<br><br>do-down: func [event] [<br>    mouse-state: 'down<br>    coord1: event/offset<br>]<br><br>do-up: func [] [<br>    mouse-state: 'up<br>]<br><br>do-move: func [event] [<br>    if mouse-state = 'down [   ;-- and over the canvas<br>        draw-block: copy []<br>        draw-block: compose [box (coord1) (event/offset)] ;based on mouse<br>        canvas/draw: draw-block<br>    ]<br>]<br><br>view [<br>    canvas: base 200x200 white all-over  ;-- nb all-over<br>    on-up [do-up]<br>    on-down [do-down event]<br>    on-over [do-move event]<br>]<br><br><a href="#top">top</a></pre><h2 id="12">5.2. Shape Sub-dialect</h2><pre><br>The Shape sub-dialect has similar commands to Draw, but they can be more <br>convenient, such as:<br><br>    - automatically closing shapes<br><br>    - relative drawing, from the previous point.  This is done by using the <br>lit-word version - for example 'line rather than line.<br><br>We enclose the commands in a block, after 'shape'.  Here is some code <br><br>Red [needs 'View]<br><br>;-- shape dialect<br>do-down: func [] [<br>    canvas/draw: [<br>        line-width 5 shape [<br>            line 0x0 90x30 30x90<br>            'hline 90 'vline 22<br>        ]<br>    ]<br>]<br><br>view [<br>    start-btn: button "Draw" [do-down]<br>    return<br>    canvas: base 300x200 white draw [line-width 7]<br>]<br><br>    - It draws 2 lines - note the series of points - (3 here, not 4) - for <br>the line command.<br><br>    - It uses the relative versions 'hline, 'vline to draw horizontal and <br>vertical lines, with one parameter specified.<br><br>    - It closes the shape (the long 45 degree diagonal line).<br><br><br>Screenshot:<br><img src="draw-sub-dialect.png" alt="draw-sub-dialect.png"><br><br>The official doc is at:<br><a href="https://doc.red-lang.org/en/draw.html#_shape_commands"><br>https://doc.red-lang.org/en/draw.html#_shape_commands</a><br><br><a href="#top">top</a></pre><h2 id="13">6.1 Transformations On Drawings</h2><pre><br>Red provides facilities to transform drawings, such as scaling, rotating.  <br>There are also facilities to work with transformation matrices directly.<br><br>In general, the transformations work on all draw commands which follow them. <br>Alternatively, you can restrict the transformations to a block.<br><br>Here is the basis of a clock program.  It initially draws a vertical line, <br>and then rotates it by 6 degrees, about one of its ends.  The rate of the <br>canvas tick is once per second, so effectively, we have a clock second-hand.<br><br>Red [needs 'View ]<br><br>do-rot: func [] [<br>    canvas/draw: compose[rotate 6 150x150 (canvas/draw) ]  <br>]<br> <br>view[<br>    canvas: base 330x330 white rate 1<br>        draw [line 150x150 150x10]<br>        on-time [do-rot]<br>]<br><br><br>Note that we chose to rotate the current state of canvas/draw, rather than <br>incrementing an 'angle' variable.<br><br>This concludes our brief sampling of Red's Draw dialect.  Look at the <br>introduction above for more links etc.<br><!----------------------------------------------------------------------------></td></tr></table></center></body></html>